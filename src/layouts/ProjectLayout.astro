---
import type { CollectionEntry } from 'astro:content';
import '../styles/global.css';
import ArticleContainer from '@components/ArticleContainer.astro';
import ProjectSidebar from '@components/Projects/ProjectSidebar.astro';

interface Props {
  content: CollectionEntry<'projects'>;
}

const { content } = Astro.props;
const { title, image, description, tech = [], publishDate, url } = content.data;
const { Content } = await content.render();
---

<article class="crt-bg-flat px-4 md:px-12 lg:px-48 pt-8 md:pt-12 min-h-screen mx-auto">
  <ArticleContainer title={title} description={description}>
    <!-- Mobile layout -->
    <div class="md:hidden space-y-6">
        <img 
          src={image} 
          alt={title} 
          class="image-border2 w-full object-cover aspect-video" 
        />

        <ProjectSidebar 
          title={title}
          tech={tech}
          url={url}
          sourceUrl={url}
        />

      <!-- 3. Content third -->
      <div class="text-sm text-white sm:text-base mt-4 break-words overflow-hidden">
        <div class="prose-container">
          <Content />
        </div>
      </div>
    </div>
    
    <!-- Desktop -->
    <div class="hidden md:grid md:grid-cols-[3fr_auto_1fr] gap-6">
      <div class="w-full overflow-hidden">
        <img 
          src={image} 
          alt={title} 
          class="image-border2 w-full object-cover aspect-video" 
        />

        <div class="text-sm text-white sm:text-base mt-4 break-words overflow-hidden">
          <div class="prose-container">
            <Content />
          </div>
        </div>
      </div>
      
      <div class="bg-tertiary w-2px h-full"></div>

      <ProjectSidebar 
        title={title}
        tech={tech}
        url={url}
        sourceUrl={url}
      />
    </div>
  </ArticleContainer>
</article>

<style>
  /* Content overflow handling */
  .prose-container {
    width: 100%;
    overflow-wrap: break-word;
    word-wrap: break-word;
    word-break: break-word;
    hyphens: auto;
  }

  /* Pre blocks */
  :global(.prose pre) {
    max-width: 100%;
    overflow-x: auto;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  /* Code blocks */
  :global(.prose code) {
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  /* Images */
  :global(.prose img) {
    max-width: 100%;
    height: auto;
  }
  
  /* Tables */
  :global(.prose table) {
    display: block;
    overflow-x: auto;
    width: 100%;
    max-width: 100%;
  }

  /* Ensure all content inside prose is contained */
  :global(.prose *) {
    max-width: 100%;
  }
</style>